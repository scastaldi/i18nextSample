/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Inject, Injectable, Pipe } from '@angular/core';
import { I18NEXT_NAMESPACE, I18NEXT_SCOPE, I18NEXT_SERVICE } from './I18NEXT_TOKENS';
var I18NextPipe = /** @class */ (function () {
    function I18NextPipe(translateI18Next, ns, scope) {
        this.translateI18Next = translateI18Next;
        this.ns = ns;
        this.scope = scope;
    }
    /**
     * @param {?} key
     * @param {?=} options
     * @return {?}
     */
    I18NextPipe.prototype.transform = /**
     * @param {?} key
     * @param {?=} options
     * @return {?}
     */
    function (key, options) {
        options = this.prepareOptions(options);
        /** @type {?} */
        var i18nOpts = this.translateI18Next.options;
        if (options.prependScope === undefined || options.prependScope === true) {
            if (this.scope) {
                key = this.prependScope(key, this.scope, i18nOpts.keySeparator, i18nOpts.nsSeparator);
            }
        }
        if (options.prependNamespace === undefined || options.prependNamespace === true) {
            if (this.ns) {
                key = this.prependNamespace(key, this.ns, i18nOpts.nsSeparator);
            }
        }
        /** @type {?} */
        var result = this.translateI18Next.t(key, options);
        if (options.format) {
            if (result) {
                result = this.translateI18Next
                    .format(result, options.format, this.translateI18Next.language);
            }
        }
        return result;
    };
    /**
     * @private
     * @param {?} key
     * @param {?} scope
     * @param {?} keySeparator
     * @param {?} nsSeparator
     * @return {?}
     */
    I18NextPipe.prototype.prependScope = /**
     * @private
     * @param {?} key
     * @param {?} scope
     * @param {?} keySeparator
     * @param {?} nsSeparator
     * @return {?}
     */
    function (key, scope, keySeparator, nsSeparator) {
        var _this = this;
        if (typeof (key) === 'string') {
            key = [key];
        }
        if (typeof (scope) === 'string') {
            scope = [scope];
        }
        /** @type {?} */
        var keysWithScope = [];
        var _loop_1 = function (i) {
            /** @type {?} */
            var k = key[i];
            if (!this_1.keyContainsNsSeparator(k, nsSeparator)) { // Do not set scope, if key contains a namespace
                keysWithScope.push.apply(// Do not set scope, if key contains a namespace
                keysWithScope, tslib_1.__spread(scope.map((/**
                 * @param {?} sc
                 * @return {?}
                 */
                function (sc) { return _this.joinStrings(keySeparator, sc, k); }))));
            }
            keysWithScope.push(k);
        };
        var this_1 = this;
        for (var i = 0; i < key.length; i++) {
            _loop_1(i);
        }
        return keysWithScope;
    };
    /**
     * @private
     * @param {?} key
     * @param {?} ns
     * @param {?} nsSeparator
     * @return {?}
     */
    I18NextPipe.prototype.prependNamespace = /**
     * @private
     * @param {?} key
     * @param {?} ns
     * @param {?} nsSeparator
     * @return {?}
     */
    function (key, ns, nsSeparator) {
        var _this = this;
        if (typeof (key) === 'string') {
            key = [key];
        }
        if (typeof (ns) === 'string') {
            ns = [ns];
        }
        /** @type {?} */
        var keysWithNamespace = [];
        var _loop_2 = function (i) {
            /** @type {?} */
            var k = key[i];
            if (!this_2.keyContainsNsSeparator(k, nsSeparator)) { // Do not set namespace, if key contains a namespace
                keysWithNamespace.push.apply(// Do not set namespace, if key contains a namespace
                keysWithNamespace, tslib_1.__spread(ns.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                function (n) { return _this.joinStrings(nsSeparator, n, k); }))));
            }
            keysWithNamespace.push(k);
        };
        var this_2 = this;
        for (var i = 0; i < key.length; i++) {
            _loop_2(i);
        }
        return keysWithNamespace;
    };
    /**
     * @private
     * @param {?} separator
     * @param {...?} str
     * @return {?}
     */
    I18NextPipe.prototype.joinStrings = /**
     * @private
     * @param {?} separator
     * @param {...?} str
     * @return {?}
     */
    function (separator) {
        var str = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            str[_i - 1] = arguments[_i];
        }
        return tslib_1.__spread(str).join(separator);
    };
    /**
     * @private
     * @param {?} key
     * @param {?} nsSeparator
     * @return {?}
     */
    I18NextPipe.prototype.keyContainsNsSeparator = /**
     * @private
     * @param {?} key
     * @param {?} nsSeparator
     * @return {?}
     */
    function (key, nsSeparator) {
        return key.indexOf(nsSeparator) !== -1;
    };
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    I18NextPipe.prototype.prepareOptions = /**
     * @private
     * @param {?} options
     * @return {?}
     */
    function (options) {
        options = options || {};
        if (options.context != null)
            options.context = options.context.toString();
        return options;
    };
    I18NextPipe.decorators = [
        { type: Injectable },
        { type: Pipe, args: [{
                    name: 'i18next'
                },] }
    ];
    /** @nocollapse */
    I18NextPipe.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [I18NEXT_SERVICE,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [I18NEXT_NAMESPACE,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [I18NEXT_SCOPE,] }] }
    ]; };
    return I18NextPipe;
}());
export { I18NextPipe };
if (false) {
    /**
     * @type {?}
     * @private
     */
    I18NextPipe.prototype.translateI18Next;
    /**
     * @type {?}
     * @private
     */
    I18NextPipe.prototype.ns;
    /**
     * @type {?}
     * @private
     */
    I18NextPipe.prototype.scope;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSTE4TmV4dFBpcGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLWkxOG5leHQvIiwic291cmNlcyI6WyJJMThOZXh0UGlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFFeEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLGFBQWEsRUFBRSxlQUFlLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVyRjtJQU1FLHFCQUNxQyxnQkFBcUMsRUFDbkMsRUFBcUIsRUFDekIsS0FBd0I7UUFGdEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFxQjtRQUNuQyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUN6QixVQUFLLEdBQUwsS0FBSyxDQUFtQjtJQUFHLENBQUM7Ozs7OztJQUV4RCwrQkFBUzs7Ozs7SUFBaEIsVUFBaUIsR0FBc0IsRUFBRSxPQUFhO1FBQ3BELE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDOztZQUVuQyxRQUFRLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU87UUFDNUMsSUFBSSxPQUFPLENBQUMsWUFBWSxLQUFLLFNBQVMsSUFBSSxPQUFPLENBQUMsWUFBWSxLQUFLLElBQUksRUFBRTtZQUN2RSxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ2QsR0FBRyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7YUFDdkY7U0FDRjtRQUNELElBQUksT0FBTyxDQUFDLGdCQUFnQixLQUFLLFNBQVMsSUFBSSxPQUFPLENBQUMsZ0JBQWdCLEtBQUssSUFBSSxFQUFFO1lBQy9FLElBQUksSUFBSSxDQUFDLEVBQUUsRUFBRTtnQkFDWCxHQUFHLEdBQUcsSUFBSSxDQUFD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Q0FBQyxFQUFFO29CQUExQixDQUFDO1NBTVQ7UUFDRCxPQUFPLGlCQUFpQixDQUFDO0lBQzNCLENBQUM7Ozs7Ozs7SUFFTyxpQ0FBVzs7Ozs7O0lBQW5CLFVBQW9CLFNBQWlCO1FBQUUsYUFBZ0I7YUFBaEIsVUFBZ0IsRUFBaEIscUJBQWdCLEVBQWhCLElBQWdCO1lBQWhCLDRCQUFnQjs7UUFDckQsT0FBTyxpQkFBSSxHQUFHLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7Ozs7Ozs7SUFFTyw0Q0FBc0I7Ozs7OztJQUE5QixVQUErQixHQUFXLEVBQUUsV0FBbUI7UUFDN0QsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7Ozs7OztJQUVPLG9DQUFjOzs7OztJQUF0QixVQUF1QixPQUFZO1FBQ2pDLE9BQU8sR0FBRyxPQUFPLElBQUksRUFBRSxDQUFDO1FBQ3hCLElBQUksT0FBTyxDQUFDLE9BQU8sSUFBSSxJQUFJO1lBQ3pCLE9BQU8sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUMvQyxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDOztnQkFwRkYsVUFBVTtnQkFDVixJQUFJLFNBQUM7b0JBQ0YsSUFBSSxFQUFFLFNBQVM7aUJBQ2xCOzs7O2dEQUlNLE1BQU0sU0FBQyxlQUFlO2dEQUN0QixNQUFNLFNBQUMsaUJBQWlCO2dEQUN4QixNQUFNLFNBQUMsYUFBYTs7SUE0RTNCLGtCQUFDO0NBQUEsQUFyRkQsSUFxRkM7U0FqRlksV0FBVzs7Ozs7O0lBR2xCLHVDQUFzRTs7Ozs7SUFDdEUseUJBQXdEOzs7OztJQUN4RCw0QkFBdUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIFBpcGUsIFBpcGVUcmFuc2Zvcm0gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7IEkxOE5FWFRfTkFNRVNQQUNFLCBJMThORVhUX1NDT1BFLCBJMThORVhUX1NFUlZJQ0UgfSBmcm9tICcuL0kxOE5FWFRfVE9LRU5TJztcclxuaW1wb3J0IHsgSVRyYW5zbGF0aW9uU2VydmljZSB9IGZyb20gJy4vSVRyYW5zbGF0aW9uU2VydmljZSc7XHJcbkBJbmplY3RhYmxlKClcclxuQFBpcGUoe1xyXG4gICAgbmFtZTogJ2kxOG5leHQnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBJMThOZXh0UGlwZSBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgICAgQEluamVjdChJMThORVhUX1NFUlZJQ0UpIHByaXZhdGUgdHJhbnNsYXRlSTE4TmV4dDogSVRyYW5zbGF0aW9uU2VydmljZSxcclxuICAgICAgQEluamVjdChJMThORVhUX05BTUVTUEFDRSkgcHJpdmF0ZSBuczogc3RyaW5nIHwgc3RyaW5nW10sXHJcbiAgICAgIEBJbmplY3QoSTE4TkVYVF9TQ09QRSkgcHJpdmF0ZSBzY29wZTogc3RyaW5nIHwgc3RyaW5nW10pIHt9XHJcblxyXG4gIHB1YmxpYyB0cmFuc2Zvcm0oa2V5OiBzdHJpbmcgfCBzdHJpbmdbXSwgb3B0aW9ucz86IGFueSk6IHN0cmluZyB7XHJcbiAgICBvcHRpb25zID0gdGhpcy5wcmVwYXJlT3B0aW9ucyhvcHRpb25zKTtcclxuXHJcbiAgICBsZXQgaTE4bk9wdHMgPSB0aGlzLnRyYW5zbGF0ZUkxOE5leHQub3B0aW9ucztcclxuICAgIGlmIChvcHRpb25zLnByZXBlbmRTY29wZSA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMucHJlcGVuZFNjb3BlID09PSB0cnVlKSB7XHJcbiAgICAgIGlmICh0aGlzLnNjb3BlKSB7XHJcbiAgICAgICAga2V5ID0gdGhpcy5wcmVwZW5kU2NvcGUoa2V5LCB0aGlzLnNjb3BlLCBpMThuT3B0cy5rZXlTZXBhcmF0b3IsIGkxOG5PcHRzLm5zU2VwYXJhdG9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbnMucHJlcGVuZE5hbWVzcGFjZSA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMucHJlcGVuZE5hbWVzcGFjZSA9PT0gdHJ1ZSkge1xyXG4gICAgICBpZiAodGhpcy5ucykge1xyXG4gICAgICAgIGtleSA9IHRoaXMucHJlcGVuZE5hbWVzcGFjZShrZXksIHRoaXMubnMsIGkxOG5PcHRzLm5zU2VwYXJhdG9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgbGV0IHJlc3VsdCA9IHRoaXMudHJhbnNsYXRlSTE4TmV4dC50KGtleSwgb3B0aW9ucyk7XHJcbiAgICBpZiAob3B0aW9ucy5mb3JtYXQpIHtcclxuICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgIHJlc3VsdCA9IHRoaXMudHJhbnNsYXRlSTE4TmV4dFxyXG4gICAgICAgICAgLmZvcm1hdChyZXN1bHQsIG9wdGlvbnMuZm9ybWF0LCB0aGlzLnRyYW5zbGF0ZUkxOE5leHQubGFuZ3VhZ2UpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwcmVwZW5kU2NvcGUoa2V5OiBzdHJpbmcgfCBzdHJpbmdbXSwgc2NvcGU6IHN0cmluZyB8IHN0cmluZ1tdLCBrZXlTZXBhcmF0b3I6IHN0cmluZywgIG5zU2VwYXJhdG9yOiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICBpZiAodHlwZW9mKGtleSkgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIGtleSA9IFtrZXldO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZihzY29wZSkgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHNjb3BlID0gW3Njb3BlXTtcclxuICAgIH1cclxuICAgIGxldCBrZXlzV2l0aFNjb3BlID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleS5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBrID0ga2V5W2ldO1xyXG4gICAgICBpZiAoIXRoaXMua2V5Q29udGFpbnNOc1NlcGFyYXRvcihrLCBuc1NlcGFyYXRvcikpIHsgLy8gRG8gbm90IHNldCBzY29wZSwgaWYga2V5IGNvbnRhaW5zIGEgbmFtZXNwYWNlXHJcbiAgICAgICAga2V5c1dpdGhTY29wZS5wdXNoKC4uLnNjb3BlLm1hcChzYyA9PiB0aGlzLmpvaW5TdHJpbmdzKGtleVNlcGFyYXRvciwgc2MsIGspKSk7XHJcbiAgICAgIH1cclxuICAgICAga2V5c1dpdGhTY29wZS5wdXNoKGspO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGtleXNXaXRoU2NvcGU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHByZXBlbmROYW1lc3BhY2Uoa2V5OiBzdHJpbmcgfCBzdHJpbmdbXSwgbnM6IHN0cmluZyB8IHN0cmluZ1tdLCBuc1NlcGFyYXRvcjogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgaWYgKHR5cGVvZihrZXkpID09PSAnc3RyaW5nJykge1xyXG4gICAgICBrZXkgPSBba2V5XTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YobnMpID09PSAnc3RyaW5nJykge1xyXG4gICAgICBucyA9IFtuc107XHJcbiAgICB9XHJcbiAgICBsZXQga2V5c1dpdGhOYW1lc3BhY2UgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGsgPSBrZXlbaV07XHJcbiAgICAgIGlmICghdGhpcy5rZXlDb250YWluc05zU2VwYXJhdG9yKGssIG5zU2VwYXJhdG9yKSkgeyAvLyBEbyBub3Qgc2V0IG5hbWVzcGFjZSwgaWYga2V5IGNvbnRhaW5zIGEgbmFtZXNwYWNlXHJcbiAgICAgICAga2V5c1dpdGhOYW1lc3BhY2UucHVzaCguLi5ucy5tYXAobiA9PiB0aGlzLmpvaW5TdHJpbmdzKG5zU2VwYXJhdG9yLCBuLCBrKSkpO1xyXG4gICAgICB9XHJcbiAgICAgIGtleXNXaXRoTmFtZXNwYWNlLnB1c2goayk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ga2V5c1dpdGhOYW1lc3BhY2U7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGpvaW5TdHJpbmdzKHNlcGFyYXRvcjogc3RyaW5nLCAuLi5zdHI6IHN0cmluZ1tdKSB7XHJcbiAgICByZXR1cm4gWy4uLnN0cl0uam9pbihzZXBhcmF0b3IpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBrZXlDb250YWluc05zU2VwYXJhdG9yKGtleTogc3RyaW5nLCBuc1NlcGFyYXRvcjogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4ga2V5LmluZGV4T2YobnNTZXBhcmF0b3IpICE9PSAtMTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcHJlcGFyZU9wdGlvbnMob3B0aW9uczogYW55KSB7XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuICAgIGlmIChvcHRpb25zLmNvbnRleHQgIT0gbnVsbClcclxuICAgICAgb3B0aW9ucy5jb250ZXh0ID0gb3B0aW9ucy5jb250ZXh0LnRvU3RyaW5nKCk7XHJcbiAgICByZXR1cm4gb3B0aW9ucztcclxuICB9XHJcbn1cclxuIl19