/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable, Pipe } from '@angular/core';
import { I18NEXT_NAMESPACE, I18NEXT_SCOPE, I18NEXT_SERVICE } from './I18NEXT_TOKENS';
export class I18NextPipe {
    /**
     * @param {?} translateI18Next
     * @param {?} ns
     * @param {?} scope
     */
    constructor(translateI18Next, ns, scope) {
        this.translateI18Next = translateI18Next;
        this.ns = ns;
        this.scope = scope;
    }
    /**
     * @param {?} key
     * @param {?=} options
     * @return {?}
     */
    transform(key, options) {
        options = this.prepareOptions(options);
        /** @type {?} */
        let i18nOpts = this.translateI18Next.options;
        if (options.prependScope === undefined || options.prependScope === true) {
            if (this.scope) {
                key = this.prependScope(key, this.scope, i18nOpts.keySeparator, i18nOpts.nsSeparator);
            }
        }
        if (options.prependNamespace === undefined || options.prependNamespace === true) {
            if (this.ns) {
                key = this.prependNamespace(key, this.ns, i18nOpts.nsSeparator);
            }
        }
        /** @type {?} */
        let result = this.translateI18Next.t(key, options);
        if (options.format) {
            if (result) {
                result = this.translateI18Next
                    .format(result, options.format, this.translateI18Next.language);
            }
        }
        return result;
    }
    /**
     * @private
     * @param {?} key
     * @param {?} scope
     * @param {?} keySeparator
     * @param {?} nsSeparator
     * @return {?}
     */
    prependScope(key, scope, keySeparator, nsSeparator) {
        if (typeof (key) === 'string') {
            key = [key];
        }
        if (typeof (scope) === 'string') {
            scope = [scope];
        }
        /** @type {?} */
        let keysWithScope = [];
        for (let i = 0; i < key.length; i++) {
            /** @type {?} */
            const k = key[i];
            if (!this.keyContainsNsSeparator(k, nsSeparator)) { // Do not set scope, if key contains a namespace
                keysWithScope.push(...scope.map((/**
                 * @param {?} sc
                 * @return {?}
                 */
                sc => this.joinStrings(keySeparator, sc, k))));
            }
            keysWithScope.push(k);
        }
        return keysWithScope;
    }
    /**
     * @private
     * @param {?} key
     * @param {?} ns
     * @param {?} nsSeparator
     * @return {?}
     */
    prependNamespace(key, ns, nsSeparator) {
        if (typeof (key) === 'string') {
            key = [key];
        }
        if (typeof (ns) === 'string') {
            ns = [ns];
        }
        /** @type {?} */
        let keysWithNamespace = [];
        for (let i = 0; i < key.length; i++) {
            /** @type {?} */
            const k = key[i];
            if (!this.keyContainsNsSeparator(k, nsSeparator)) { // Do not set namespace, if key contains a namespace
                keysWithNamespace.push(...ns.map((/**
                 * @param {?} n
                 * @return {?}
                 */
                n => this.joinStrings(nsSeparator, n, k))));
            }
            keysWithNamespace.push(k);
        }
        return keysWithNamespace;
    }
    /**
     * @private
     * @param {?} separator
     * @param {...?} str
     * @return {?}
     */
    joinStrings(separator, ...str) {
        return [...str].join(separator);
    }
    /**
     * @private
     * @param {?} key
     * @param {?} nsSeparator
     * @return {?}
     */
    keyContainsNsSeparator(key, nsSeparator) {
        return key.indexOf(nsSeparator) !== -1;
    }
    /**
     * @private
     * @param {?} options
     * @return {?}
     */
    prepareOptions(options) {
        options = options || {};
        if (options.context != null)
            options.context = options.context.toString();
        return options;
    }
}
I18NextPipe.decorators = [
    { type: Injectable },
    { type: Pipe, args: [{
                name: 'i18next'
            },] }
];
/** @nocollapse */
I18NextPipe.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [I18NEXT_SERVICE,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [I18NEXT_NAMESPACE,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [I18NEXT_SCOPE,] }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    I18NextPipe.prototype.translateI18Next;
    /**
     * @type {?}
     * @private
     */
    I18NextPipe.prototype.ns;
    /**
     * @type {?}
     * @private
     */
    I18NextPipe.prototype.scope;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSTE4TmV4dFBpcGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLWkxOG5leHQvIiwic291cmNlcyI6WyJJMThOZXh0UGlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUV4RSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsYUFBYSxFQUFFLGVBQWUsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBTXJGLE1BQU0sT0FBTyxXQUFXOzs7Ozs7SUFFdEIsWUFDcUMsZ0JBQXFDLEVBQ25DLEVBQXFCLEVBQ3pCLEtBQXdCO1FBRnRCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBcUI7UUFDbkMsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFDekIsVUFBSyxHQUFMLEtBQUssQ0FBbUI7SUFBRyxDQUFDOzs7Ozs7SUFFeEQsU0FBUyxDQUFDLEdBQXNCLEVBQUUsT0FBYTtRQUNwRCxPQUFPLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQzs7WUFFbkMsUUFBUSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPO1FBQzVDLElBQUksT0FBTyxDQUFDLFlBQVksS0FBSyxTQUFTLElBQUksT0FBTyxDQUFDLFlBQVksS0FBSyxJQUFJLEVBQUU7WUFDdkUsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO2dCQUNkLEdBQUcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxZQUFZLEVBQUUsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO2FBQ3ZGO1NBQ0Y7UUFDRCxJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsS0FBSyxTQUFTLElBQUksT0FBTyxDQUFDLGdCQUFnQixLQUFLLElBQUksRUFBRTtZQUMvRSxJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ1gsR0FBRyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7YUFDakU7U0FDRjs7WUFDRyxNQUFNLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDO1FBQ2xELElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtZQUNsQixJQUFJLE1BQU0sRUFBRTtnQkFDVixNQUFNLEdBQUcsSUFBSSxDQUFDLGdCQUFnQjtxQkFDM0IsTUFBTSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNuRTtTQUNGO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQzs7Ozs7Ozs7O0lBRU8sWUFBWSxDQUFDLEdBQXNCLEVBQUUsS0FBd0IsRUFBRSxZQUFvQixFQUFHLFdBQW1CO1FBQy9HLElBQUksT0FBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLFFBQVEsRUFBRTtZQUM1QixHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNiO1FBQ0QsSUFBSSxPQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssUUFBUSxFQUFFO1lBQzlCLEtBQUssR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2pCOztZQUNHLGFBQWEsR0FBRyxFQUFFO1FBQ3RCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFOztrQkFDN0IsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLEVBQUUsRUFBRSxnREFBZ0Q7Z0JBQ2xHLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsR0FBRzs7OztnQkFBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7YUFDL0U7WUFDRCxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBQ0QsT0FBTyxhQUFhLENBQUM7SUFDdkIsQ0FBQzs7Ozs7Ozs7SUFFTyxnQkFBZ0IsQ0FBQyxHQUFzQixFQUFFLEVBQXFCLEVBQUUsV0FBbUI7UUFDekYsSUFBSSxPQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssUUFBUSxFQUFFO1lBQzVCLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ2I7UUFDRCxJQUFJLE9BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxRQUFRLEVBQUU7WUFDM0IsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDWDs7WUFDRyxpQkFBaUIsR0FBRyxFQUFFO1FBQzFCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFOztrQkFDN0IsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLEVBQUUsRUFBRSxvREFBb0Q7Z0JBQ3RHLGlCQUFpQixDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHOzs7O2dCQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQzthQUM3RTtZQUNELGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUMzQjtRQUNELE9BQU8saUJBQWlCLENBQUM7SUFDM0IsQ0FBQzs7Ozs7OztJQUVPLFdBQVcsQ0FBQyxTQUFpQixFQUFFLEdBQUcsR0FBYTtRQUNyRCxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbEMsQ0FBQzs7Ozs7OztJQUVPLHNCQUFzQixDQUFDLEdBQVcsRUFBRSxXQUFtQjtRQUM3RCxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDekMsQ0FBQzs7Ozs7O0lBRU8sY0FBYyxDQUFDLE9BQVk7UUFDakMsT0FBTyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFDeEIsSUFBSSxPQUFPLENBQUMsT0FBTyxJQUFJLElBQUk7WUFDekIsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQy9DLE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7OztZQXBGRixVQUFVO1lBQ1YsSUFBSSxTQUFDO2dCQUNGLElBQUksRUFBRSxTQUFTO2FBQ2xCOzs7OzRDQUlNLE1BQU0sU0FBQyxlQUFlOzRDQUN0QixNQUFNLFNBQUMsaUJBQWlCOzRDQUN4QixNQUFNLFNBQUMsYUFBYTs7Ozs7OztJQUZyQix1Q0FBc0U7Ozs7O0lBQ3RFLHlCQUF3RDs7Ozs7SUFDeEQsNEJBQXVEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBQaXBlLCBQaXBlVHJhbnNmb3JtIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBJMThORVhUX05BTUVTUEFDRSwgSTE4TkVYVF9TQ09QRSwgSTE4TkVYVF9TRVJWSUNFIH0gZnJvbSAnLi9JMThORVhUX1RPS0VOUyc7XHJcbmltcG9ydCB7IElUcmFuc2xhdGlvblNlcnZpY2UgfSBmcm9tICcuL0lUcmFuc2xhdGlvblNlcnZpY2UnO1xyXG5ASW5qZWN0YWJsZSgpXHJcbkBQaXBlKHtcclxuICAgIG5hbWU6ICdpMThuZXh0J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgSTE4TmV4dFBpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICAgIEBJbmplY3QoSTE4TkVYVF9TRVJWSUNFKSBwcml2YXRlIHRyYW5zbGF0ZUkxOE5leHQ6IElUcmFuc2xhdGlvblNlcnZpY2UsXHJcbiAgICAgIEBJbmplY3QoSTE4TkVYVF9OQU1FU1BBQ0UpIHByaXZhdGUgbnM6IHN0cmluZyB8IHN0cmluZ1tdLFxyXG4gICAgICBASW5qZWN0KEkxOE5FWFRfU0NPUEUpIHByaXZhdGUgc2NvcGU6IHN0cmluZyB8IHN0cmluZ1tdKSB7fVxyXG5cclxuICBwdWJsaWMgdHJhbnNmb3JtKGtleTogc3RyaW5nIHwgc3RyaW5nW10sIG9wdGlvbnM/OiBhbnkpOiBzdHJpbmcge1xyXG4gICAgb3B0aW9ucyA9IHRoaXMucHJlcGFyZU9wdGlvbnMob3B0aW9ucyk7XHJcblxyXG4gICAgbGV0IGkxOG5PcHRzID0gdGhpcy50cmFuc2xhdGVJMThOZXh0Lm9wdGlvbnM7XHJcbiAgICBpZiAob3B0aW9ucy5wcmVwZW5kU2NvcGUgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLnByZXBlbmRTY29wZSA9PT0gdHJ1ZSkge1xyXG4gICAgICBpZiAodGhpcy5zY29wZSkge1xyXG4gICAgICAgIGtleSA9IHRoaXMucHJlcGVuZFNjb3BlKGtleSwgdGhpcy5zY29wZSwgaTE4bk9wdHMua2V5U2VwYXJhdG9yLCBpMThuT3B0cy5uc1NlcGFyYXRvcik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChvcHRpb25zLnByZXBlbmROYW1lc3BhY2UgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLnByZXBlbmROYW1lc3BhY2UgPT09IHRydWUpIHtcclxuICAgICAgaWYgKHRoaXMubnMpIHtcclxuICAgICAgICBrZXkgPSB0aGlzLnByZXBlbmROYW1lc3BhY2Uoa2V5LCB0aGlzLm5zLCBpMThuT3B0cy5uc1NlcGFyYXRvcik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGxldCByZXN1bHQgPSB0aGlzLnRyYW5zbGF0ZUkxOE5leHQudChrZXksIG9wdGlvbnMpO1xyXG4gICAgaWYgKG9wdGlvbnMuZm9ybWF0KSB7XHJcbiAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICByZXN1bHQgPSB0aGlzLnRyYW5zbGF0ZUkxOE5leHRcclxuICAgICAgICAgIC5mb3JtYXQocmVzdWx0LCBvcHRpb25zLmZvcm1hdCwgdGhpcy50cmFuc2xhdGVJMThOZXh0Lmxhbmd1YWdlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcHJlcGVuZFNjb3BlKGtleTogc3RyaW5nIHwgc3RyaW5nW10sIHNjb3BlOiBzdHJpbmcgfCBzdHJpbmdbXSwga2V5U2VwYXJhdG9yOiBzdHJpbmcsICBuc1NlcGFyYXRvcjogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgaWYgKHR5cGVvZihrZXkpID09PSAnc3RyaW5nJykge1xyXG4gICAgICBrZXkgPSBba2V5XTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Yoc2NvcGUpID09PSAnc3RyaW5nJykge1xyXG4gICAgICBzY29wZSA9IFtzY29wZV07XHJcbiAgICB9XHJcbiAgICBsZXQga2V5c1dpdGhTY29wZSA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgayA9IGtleVtpXTtcclxuICAgICAgaWYgKCF0aGlzLmtleUNvbnRhaW5zTnNTZXBhcmF0b3IoaywgbnNTZXBhcmF0b3IpKSB7IC8vIERvIG5vdCBzZXQgc2NvcGUsIGlmIGtleSBjb250YWlucyBhIG5hbWVzcGFjZVxyXG4gICAgICAgIGtleXNXaXRoU2NvcGUucHVzaCguLi5zY29wZS5tYXAoc2MgPT4gdGhpcy5qb2luU3RyaW5ncyhrZXlTZXBhcmF0b3IsIHNjLCBrKSkpO1xyXG4gICAgICB9XHJcbiAgICAgIGtleXNXaXRoU2NvcGUucHVzaChrKTtcclxuICAgIH1cclxuICAgIHJldHVybiBrZXlzV2l0aFNjb3BlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwcmVwZW5kTmFtZXNwYWNlKGtleTogc3RyaW5nIHwgc3RyaW5nW10sIG5zOiBzdHJpbmcgfCBzdHJpbmdbXSwgbnNTZXBhcmF0b3I6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIGlmICh0eXBlb2Yoa2V5KSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAga2V5ID0gW2tleV07XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mKG5zKSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgbnMgPSBbbnNdO1xyXG4gICAgfVxyXG4gICAgbGV0IGtleXNXaXRoTmFtZXNwYWNlID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleS5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBrID0ga2V5W2ldO1xyXG4gICAgICBpZiAoIXRoaXMua2V5Q29udGFpbnNOc1NlcGFyYXRvcihrLCBuc1NlcGFyYXRvcikpIHsgLy8gRG8gbm90IHNldCBuYW1lc3BhY2UsIGlmIGtleSBjb250YWlucyBhIG5hbWVzcGFjZVxyXG4gICAgICAgIGtleXNXaXRoTmFtZXNwYWNlLnB1c2goLi4ubnMubWFwKG4gPT4gdGhpcy5qb2luU3RyaW5ncyhuc1NlcGFyYXRvciwgbiwgaykpKTtcclxuICAgICAgfVxyXG4gICAgICBrZXlzV2l0aE5hbWVzcGFjZS5wdXNoKGspO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGtleXNXaXRoTmFtZXNwYWNlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBqb2luU3RyaW5ncyhzZXBhcmF0b3I6IHN0cmluZywgLi4uc3RyOiBzdHJpbmdbXSkge1xyXG4gICAgcmV0dXJuIFsuLi5zdHJdLmpvaW4oc2VwYXJhdG9yKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUga2V5Q29udGFpbnNOc1NlcGFyYXRvcihrZXk6IHN0cmluZywgbnNTZXBhcmF0b3I6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIGtleS5pbmRleE9mKG5zU2VwYXJhdG9yKSAhPT0gLTE7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHByZXBhcmVPcHRpb25zKG9wdGlvbnM6IGFueSkge1xyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcbiAgICBpZiAob3B0aW9ucy5jb250ZXh0ICE9IG51bGwpXHJcbiAgICAgIG9wdGlvbnMuY29udGV4dCA9IG9wdGlvbnMuY29udGV4dC50b1N0cmluZygpO1xyXG4gICAgcmV0dXJuIG9wdGlvbnM7XHJcbiAgfVxyXG59XHJcbiJdfQ==