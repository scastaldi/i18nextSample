/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable } from '@angular/core';
import * as i18n from 'i18next';
import { I18NEXT_ERROR_HANDLING_STRATEGY } from './I18NEXT_TOKENS';
import { I18NextEvents } from './I18NextEvents';
/** @type {?} */
const i18next = i18n.default;
export class I18NextService {
    /**
     * @param {?} errorHandlingStrategy
     */
    constructor(errorHandlingStrategy) {
        this.errorHandlingStrategy = errorHandlingStrategy;
        this.events = new I18NextEvents();
        this.language = '';
        this.languages = [];
    }
    /**
     * @return {?}
     */
    get options() {
        return i18next.options;
    }
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} plugin
     * @return {THIS}
     */
    use(plugin) {
        i18next.use.call(i18next, plugin);
        return (/** @type {?} */ (this));
    }
    /**
     * @param {?=} options
     * @return {?}
     */
    init(options) {
        options = options || {};
        this.subscribeEvents();
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            i18next.init.call(i18next, Object.assign({}, options), this.errorHandlingStrategy.handle(resolve, reject));
        }));
    }
    /**
     * @param {?} key
     * @param {?=} options
     * @return {?}
     */
    t(key, options) {
        options = options || {};
        return i18next.t.call(i18next, (/** @type {?} */ (key)), options);
    }
    /**
     * @param {?} value
     * @param {?} format
     * @param {?} lng
     * @return {?}
     */
    format(value, format, lng) {
        return i18next.format.call(i18next, value, format, lng);
    }
    /**
     * @param {?} key
     * @param {?} options
     * @return {?}
     */
    exists(key, options) {
        return i18next.exists.call(i18next, key, options);
    }
    /**
     * @param {?} lng
     * @param {?} ns
     * @return {?}
     */
    getFixedT(lng, ns) {
        return i18next.getFixedT.call(i18next, lng, ns);
    }
    /**
     * @param {?} ns
     * @return {?}
     */
    setDefaultNamespace(ns) {
        i18next.setDefaultNamespace.call(i18next, ns);
    }
    /**
     * @param {?=} lng
     * @return {?}
     */
    dir(lng = undefined) {
        return i18next.dir.call(i18next, lng);
    }
    /**
     * @param {?} lng
     * @return {?}
     */
    changeLanguage(lng) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            i18next.changeLanguage.call(i18next, lng, this.errorHandlingStrategy.handle(resolve, reject));
        }));
    }
    /**
     * @param {?} namespaces
     * @return {?}
     */
    loadNamespaces(namespaces) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            i18next.loadNamespaces.call(i18next, namespaces, this.errorHandlingStrategy.handle(resolve, reject));
        }));
    }
    /**
     * @param {?} lngs
     * @param {?} callback
     * @return {?}
     */
    loadLanguages(lngs, callback) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            i18next.loadNamespaces.call(i18next, lngs, this.errorHandlingStrategy.handle(resolve, reject));
        }));
    }
    //#region resource handling
    /**
     * @param {...?} params
     * @return {?}
     */
    reloadResources(...params) {
        i18next.reloadResources.apply(i18next, params);
    }
    /**
     * @param {?} lng
     * @param {?} ns
     * @param {?} key
     * @param {?} options
     * @return {?}
     */
    getResource(lng, ns, key, options) {
        return i18next.getResource.call(i18next, lng, ns, key, options);
    }
    /**
     * @param {?} lng
     * @param {?} ns
     * @param {?} key
     * @param {?} value
     * @param {?} options
     * @return {?}
     */
    addResource(lng, ns, key, value, options) {
        i18next.addResource.call(i18next, lng, ns, key, value, options);
    }
    /**
     * @param {?} lng
     * @param {?} ns
     * @param {?} resources
     * @return {?}
     */
    addResources(lng, ns, resources) {
        i18next.addResources.call(i18next, lng, ns, resources);
    }
    /**
     * @param {?} lng
     * @param {?} ns
     * @param {?} resources
     * @param {?} deep
     * @param {?} overwrite
     * @return {?}
     */
    addResourceBundle(lng, ns, resources, deep, overwrite) {
        i18next.addResourceBundle.call(i18next, lng, ns, resources, deep, overwrite);
    }
    /**
     * @param {?} lng
     * @param {?} ns
     * @return {?}
     */
    hasResourceBundle(lng, ns) {
        return i18next.hasResourceBundle.call(i18next, lng, ns);
    }
    /**
     * @param {?} lng
     * @param {?} ns
     * @return {?}
     */
    getResourceBundle(lng, ns) {
        return i18next.getResourceBundle.call(i18next, lng, ns);
    }
    /**
     * @param {?} lng
     * @param {?} ns
     * @return {?}
     */
    removeResourceBundle(lng, ns) {
        i18next.removeResourceBundle.call(i18next, lng, ns);
    }
    //#endregion
    /**
     * @private
     * @return {?}
     */
    subscribeEvents() {
        i18next.on.call(i18next, 'initialized', (/**
         * @param {?} options
         * @return {?}
         */
        options => {
            this.language = i18next.language;
            this.languages = i18next.languages;
            this.events.initialized.next(options);
        }));
        i18next.on.call(i18next, 'loaded', (/**
         * @param {?} loaded
         * @return {?}
         */
        loaded => this.events.loaded.next(loaded)));
        i18next.on.call(i18next, 'failedLoading', (/**
         * @param {?} lng
         * @param {?} ns
         * @param {?} msg
         * @return {?}
         */
        (lng, ns, msg) => this.events.failedLoading.next({ lng, ns, msg })));
        i18next.on.call(i18next, 'languageChanged', (/**
         * @param {?} lng
         * @return {?}
         */
        lng => {
            this.language = i18next.language;
            this.languages = i18next.languages;
            this.events.languageChanged.next(lng);
        }));
        i18next.on.call(i18next, 'missingKey', (/**
         * @param {?} lngs
         * @param {?} namespace
         * @param {?} key
         * @param {?} res
         * @return {?}
         */
        (lngs, namespace, key, res) => this.events.missingKey.next({ lngs, namespace, key, res })));
        i18next.on.call(i18next, 'added', (/**
         * @param {?} lng
         * @param {?} ns
         * @return {?}
         */
        (lng, ns) => this.events.added.next({ lng, ns })));
        i18next.on.call(i18next, 'removed', (/**
         * @param {?} lng
         * @param {?} ns
         * @return {?}
         */
        (lng, ns) => this.events.removed.next({ lng, ns })));
    }
}
I18NextService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
I18NextService.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [I18NEXT_ERROR_HANDLING_STRATEGY,] }] }
];
if (false) {
    /** @type {?} */
    I18NextService.prototype.events;
    /** @type {?} */
    I18NextService.prototype.language;
    /** @type {?} */
    I18NextService.prototype.languages;
    /**
     * @type {?}
     * @private
     */
    I18NextService.prototype.errorHandlingStrategy;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSTE4TmV4dFNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLWkxOG5leHQvIiwic291cmNlcyI6WyJJMThOZXh0U2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxLQUFLLElBQUksTUFBTSxTQUFTLENBQUM7QUFFaEMsT0FBTyxFQUFFLCtCQUErQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFbkUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDOztNQU0xQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU87QUFHNUIsTUFBTSxPQUFPLGNBQWM7Ozs7SUFVekIsWUFBNkQscUJBQW1EO1FBQW5ELDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBOEI7UUFSaEgsV0FBTSxHQUF1QixJQUFJLGFBQWEsRUFBRSxDQUFDO1FBQ2pELGFBQVEsR0FBVyxFQUFFLENBQUM7UUFDdEIsY0FBUyxHQUFhLEVBQUUsQ0FBQztJQU0wRixDQUFDOzs7O0lBSnBILElBQUksT0FBTztRQUNULE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQztJQUN6QixDQUFDOzs7Ozs7O0lBSU0sR0FBRyxDQUFDLE1BQVc7UUFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2xDLE9BQU8sbUJBQUEsSUFBSSxFQUFBLENBQUM7SUFDZCxDQUFDOzs7OztJQUVNLElBQUksQ0FBQyxPQUFhO1FBQ3ZCLE9BQU8sR0FBRyxPQUFPLElBQUksRUFBRSxDQUFDO1FBRXhCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUV2QixPQUFPLElBQUksT0FBTzs7Ozs7UUFDZCxDQUNFLE9BQXVELEVBQ3ZELE1BQTRCLEVBQzVCLEVBQUU7WUFDRixPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFP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QUN4QyxDQUFDLEVBQUMsQ0FBQztRQUNILE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxZQUFZOzs7Ozs7O1FBQUUsQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBQyxDQUFDLEVBQUMsQ0FBQztRQUNoSSxPQUFPLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsT0FBTzs7Ozs7UUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUMsQ0FBQyxFQUFDLENBQUM7UUFDbEYsT0FBTyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLFNBQVM7Ozs7O1FBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxHQUFHLEVBQUUsRUFBRSxFQUFDLENBQUMsRUFBQyxDQUFDO0lBRXhGLENBQUM7OztZQWpKRixVQUFVOzs7OzRDQVdJLE1BQU0sU0FBQywrQkFBK0I7Ozs7SUFSbkQsZ0NBQWlEOztJQUNqRCxrQ0FBc0I7O0lBQ3RCLG1DQUF5Qjs7Ozs7SUFNYiwrQ0FBb0ciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0ICogYXMgaTE4biBmcm9tICdpMThuZXh0JztcclxuXHJcbmltcG9ydCB7IEkxOE5FWFRfRVJST1JfSEFORExJTkdfU1RSQVRFR1kgfSBmcm9tICcuL0kxOE5FWFRfVE9LRU5TJztcclxuaW1wb3J0IHsgSTE4TmV4dEVycm9ySGFuZGxpbmdTdHJhdGVneSB9IGZyb20gJy4vSTE4TmV4dEVycm9ySGFuZGxpbmdTdHJhdGVnaWVzJztcclxuaW1wb3J0IHsgSTE4TmV4dEV2ZW50cyB9IGZyb20gJy4vSTE4TmV4dEV2ZW50cyc7XHJcbmltcG9ydCB7IEkxOE5leHRMb2FkUmVzdWx0IH0gZnJvbSAnLi9JMThOZXh0TG9hZFJlc3VsdCc7XHJcbmltcG9ydCB7IElUcmFuc2xhdGlvbkV2ZW50cyB9IGZyb20gJy4vSVRyYW5zbGF0aW9uRXZlbnRzJztcclxuaW1wb3J0IHsgSVRyYW5zbGF0aW9uU2VydmljZSB9IGZyb20gJy4vSVRyYW5zbGF0aW9uU2VydmljZSc7XHJcblxyXG5cclxuY29uc3QgaTE4bmV4dCA9IGkxOG4uZGVmYXVsdDtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEkxOE5leHRTZXJ2aWNlIGltcGxlbWVudHMgSVRyYW5zbGF0aW9uU2VydmljZSB7XHJcblxyXG4gIGV2ZW50czogSVRyYW5zbGF0aW9uRXZlbnRzID0gbmV3IEkxOE5leHRFdmVudHMoKTtcclxuICBsYW5ndWFnZTogc3RyaW5nID0gJyc7XHJcbiAgbGFuZ3VhZ2VzOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICBnZXQgb3B0aW9ucygpOiBhbnkge1xyXG4gICAgcmV0dXJuIGkxOG5leHQub3B0aW9ucztcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoSTE4TkVYVF9FUlJPUl9IQU5ETElOR19TVFJBVEVHWSkgcHJpdmF0ZSBlcnJvckhhbmRsaW5nU3RyYXRlZ3k6IEkxOE5leHRFcnJvckhhbmRsaW5nU3RyYXRlZ3kpIHt9XHJcblxyXG4gIHB1YmxpYyB1c2UocGx1Z2luOiBhbnkpIHtcclxuICAgIGkxOG5leHQudXNlLmNhbGwoaTE4bmV4dCwgcGx1Z2luKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGluaXQob3B0aW9ucz86IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgICB0aGlzLnN1YnNjcmliZUV2ZW50cygpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTxJMThOZXh0TG9hZFJlc3VsdD4oXHJcbiAgICAgICAgKFxyXG4gICAgICAgICAgcmVzb2x2ZTogKHRoZW5hYmxlT3JSZXN1bHQ/OiBJMThOZXh0TG9hZFJlc3VsdCkgPT4gdm9pZCxcclxuICAgICAgICAgIHJlamVjdDogKGVycm9yOiBhbnkpID0+IHZvaWRcclxuICAgICAgICApID0+IHtcclxuICAgICAgICAgIGkxOG5leHQuaW5pdC5jYWxsKGkxOG5leHQsIE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpLCB0aGlzLmVycm9ySGFuZGxpbmdTdHJhdGVneS5oYW5kbGUocmVzb2x2ZSwgcmVqZWN0KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG5cclxuICB9XHJcblxyXG4gIHB1YmxpYyB0KGtleTogc3RyaW5nIHwgc3RyaW5nW10sIG9wdGlvbnM/OiBhbnkpOiBzdHJpbmcge1xyXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XHJcbiAgICByZXR1cm4gaTE4bmV4dC50LmNhbGwoaTE4bmV4dCwgPGFueT5rZXksIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGZvcm1hdCh2YWx1ZTogYW55LCBmb3JtYXQ6IHN0cmluZywgbG5nOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGkxOG5leHQuZm9ybWF0LmNhbGwoaTE4bmV4dCwgdmFsdWUsIGZvcm1hdCwgbG5nKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBleGlzdHMoa2V5LCBvcHRpb25zKSB7XHJcbiAgICByZXR1cm4gaTE4bmV4dC5leGlzdHMuY2FsbChpMThuZXh0LCBrZXksIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEZpeGVkVChsbmcsIG5zKSB7XHJcbiAgICByZXR1cm4gaTE4bmV4dC5nZXRGaXhlZFQuY2FsbChpMThuZXh0LCBsbmcsIG5zKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXREZWZhdWx0TmFtZXNwYWNlKG5zOiBzdHJpbmcpIHtcclxuICAgIGkxOG5leHQuc2V0RGVmYXVsdE5hbWVzcGFjZS5jYWxsKGkxOG5leHQsIG5zKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkaXIobG5nOiBzdHJpbmcgPSB1bmRlZmluZWQpIHtcclxuICAgICAgcmV0dXJuIGkxOG5leHQuZGlyLmNhbGwoaTE4bmV4dCwgbG5nKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjaGFuZ2VMYW5ndWFnZShsbmc6IHN0cmluZyk6IFByb21pc2U8STE4TmV4dExvYWRSZXN1bHQ+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTxJMThOZXh0TG9hZFJlc3VsdD4oXHJcbiAgICAgIChcclxuICAgICAgICByZXNvbHZlOiAodGhlbmFibGVPclJlc3VsdD86IEkxOE5leHRMb2FkUmVzdWx0KSA9PiB2b2lkLFxyXG4gICAgICAgIHJlamVjdDogKGVycm9yOiBhbnkpID0+IHZvaWRcclxuICAgICAgKSA9PiB7XHJcbiAgICAgICAgICBpMThuZXh0LmNoYW5nZUxhbmd1YWdlLmNhbGwoaTE4bmV4dCwgbG5nLCB0aGlzLmVycm9ySGFuZGxpbmdTdHJhdGVneS5oYW5kbGUocmVzb2x2ZSwgcmVqZWN0KSk7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbG9hZE5hbWVzcGFjZXMobmFtZXNwYWNlczogc3RyaW5nIHwgc3RyaW5nW10pOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPEkxOE5leHRMb2FkUmVzdWx0PihcclxuICAgICAgKFxyXG4gICAgICAgIHJlc29sdmU6ICh0aGVuYWJsZU9yUmVzdWx0PzogSTE4TmV4dExvYWRSZXN1bHQpID0+IHZvaWQsXHJcbiAgICAgICAgcmVqZWN0OiAoZXJyb3I6IGFueSkgPT4gdm9pZFxyXG4gICAgICApID0+IHtcclxuICAgICAgICAgIGkxOG5leHQubG9hZE5hbWVzcGFjZXMuY2FsbChpMThuZXh0LCBuYW1lc3BhY2VzLCB0aGlzLmVycm9ySGFuZGxpbmdTdHJhdGVneS5oYW5kbGUocmVzb2x2ZSwgcmVqZWN0KSk7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbG9hZExhbmd1YWdlcyhsbmdzOiBzdHJpbmcgfCBzdHJpbmdbXSwgY2FsbGJhY2s6IEZ1bmN0aW9uKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8STE4TmV4dExvYWRSZXN1bHQ+KFxyXG4gICAgICAoXHJcbiAgICAgICAgcmVzb2x2ZTogKHRoZW5hYmxlT3JSZXN1bHQ/OiBJMThOZXh0TG9hZFJlc3VsdCkgPT4gdm9pZCxcclxuICAgICAgICByZWplY3Q6IChlcnJvcjogYW55KSA9PiB2b2lkXHJcbiAgICAgICkgPT4ge1xyXG4gICAgICAgICAgaTE4bmV4dC5sb2FkTmFtZXNwYWNlcy5jYWxsKGkxOG5leHQsIGxuZ3MsIHRoaXMuZXJyb3JIYW5kbGluZ1N0cmF0ZWd5LmhhbmRsZShyZXNvbHZlLCByZWplY3QpKTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8vI3JlZ2lvbiByZXNvdXJjZSBoYW5kbGluZ1xyXG5cclxuICBwdWJsaWMgcmVsb2FkUmVzb3VyY2VzKC4uLnBhcmFtcykge1xyXG4gICAgaTE4bmV4dC5yZWxvYWRSZXNvdXJjZXMuYXBwbHkoaTE4bmV4dCwgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRSZXNvdXJjZShsbmcsIG5zLCBrZXksIG9wdGlvbnMpIHtcclxuICAgICAgcmV0dXJuIGkxOG5leHQuZ2V0UmVzb3VyY2UuY2FsbChpMThuZXh0LCBsbmcsIG5zLCBrZXksIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZFJlc291cmNlKGxuZywgbnMsIGtleSwgdmFsdWUsIG9wdGlvbnMpIHtcclxuICAgICAgaTE4bmV4dC5hZGRSZXNvdXJjZS5jYWxsKGkxOG5leHQsIGxuZywgbnMsIGtleSwgdmFsdWUsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZFJlc291cmNlcyhsbmcsIG5zLCByZXNvdXJjZXMpIHtcclxuICAgICAgaTE4bmV4dC5hZGRSZXNvdXJjZXMuY2FsbChpMThuZXh0LCBsbmcsIG5zLCByZXNvdXJjZXMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZFJlc291cmNlQnVuZGxlKGxuZywgbnMsIHJlc291cmNlcywgZGVlcCwgb3ZlcndyaXRlKSB7XHJcbiAgICAgIGkxOG5leHQuYWRkUmVzb3VyY2VCdW5kbGUuY2FsbChpMThuZXh0LCBsbmcsIG5zLCByZXNvdXJjZXMsIGRlZXAsIG92ZXJ3cml0ZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGFzUmVzb3VyY2VCdW5kbGUobG5nLCBucykge1xyXG4gICAgICByZXR1cm4gaTE4bmV4dC5oYXNSZXNvdXJjZUJ1bmRsZS5jYWxsKGkxOG5leHQsIGxuZywgbnMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFJlc291cmNlQnVuZGxlKGxuZywgbnMpIHtcclxuICAgICAgcmV0dXJuIGkxOG5leHQuZ2V0UmVzb3VyY2VCdW5kbGUuY2FsbChpMThuZXh0LCBsbmcsIG5zKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZW1vdmVSZXNvdXJjZUJ1bmRsZShsbmcsIG5zKSB7XHJcbiAgICAgIGkxOG5leHQucmVtb3ZlUmVzb3VyY2VCdW5kbGUuY2FsbChpMThuZXh0LCBsbmcsIG5zKTtcclxuICB9XHJcblxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICBwcml2YXRlIHN1YnNjcmliZUV2ZW50cygpIHtcclxuICAgIGkxOG5leHQub24uY2FsbChpMThuZXh0LCAnaW5pdGlhbGl6ZWQnLCBvcHRpb25zID0+IHtcclxuICAgICAgdGhpcy5sYW5ndWFnZSA9IGkxOG5leHQubGFuZ3VhZ2U7XHJcbiAgICAgIHRoaXMubGFuZ3VhZ2VzID0gaTE4bmV4dC5sYW5ndWFnZXM7XHJcbiAgICAgIHRoaXMuZXZlbnRzLmluaXRpYWxpemVkLm5leHQob3B0aW9ucyk7XHJcbiAgICB9KTtcclxuICAgIGkxOG5leHQub24uY2FsbChpMThuZXh0LCAnbG9hZGVkJywgbG9hZGVkID0+IHRoaXMuZXZlbnRzLmxvYWRlZC5uZXh0KGxvYWRlZCkpO1xyXG4gICAgaTE4bmV4dC5vbi5jYWxsKGkxOG5leHQsICdmYWlsZWRMb2FkaW5nJywgKGxuZywgbnMsIG1zZykgPT4gdGhpcy5ldmVudHMuZmFpbGVkTG9hZGluZy5uZXh0KHtsbmcsIG5zLCBtc2d9KSk7XHJcbiAgICBpMThuZXh0Lm9uLmNhbGwoaTE4bmV4dCwgJ2xhbmd1YWdlQ2hhbmdlZCcsIGxuZyA9PiB7XHJcbiAgICAgIHRoaXMubGFuZ3VhZ2UgPSBpMThuZXh0Lmxhbmd1YWdlO1xyXG4gICAgICB0aGlzLmxhbmd1YWdlcyA9IGkxOG5leHQubGFuZ3VhZ2VzO1xyXG4gICAgICB0aGlzLmV2ZW50cy5sYW5ndWFnZUNoYW5nZWQubmV4dChsbmcpO1xyXG4gICAgfSk7XHJcbiAgICBpMThuZXh0Lm9uLmNhbGwoaTE4bmV4dCwgJ21pc3NpbmdLZXknLCAobG5ncywgbmFtZXNwYWNlLCBrZXksIHJlcykgPT4gdGhpcy5ldmVudHMubWlzc2luZ0tleS5uZXh0KHtsbmdzLCBuYW1lc3BhY2UsIGtleSwgcmVzfSkpO1xyXG4gICAgaTE4bmV4dC5vbi5jYWxsKGkxOG5leHQsICdhZGRlZCcsIChsbmcsIG5zKSA9PiB0aGlzLmV2ZW50cy5hZGRlZC5uZXh0KHtsbmcsIG5zfSkpO1xyXG4gICAgaTE4bmV4dC5vbi5jYWxsKGkxOG5leHQsICdyZW1vdmVkJywgKGxuZywgbnMpID0+IHRoaXMuZXZlbnRzLnJlbW92ZWQubmV4dCh7bG5nLCBuc30pKTtcclxuXHJcbiAgfVxyXG59XHJcbiJdfQ==